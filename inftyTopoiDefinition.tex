\begin{definition}[$\kappa$-filtered] %HTT Definition 5.3.1.7.
    Let $\kappa$ be a regular cardinal and $C$ be an \inftycat/.
    We say that $C$ is \emph{$\kappa$-filtered} if for every map $f:K\to C$ with $K$ a $\kappa$-small simplicial set there exists a map $\overline{f}:K^{\rhd}\to C$ such that $\overline{f}\vert_K=f$.
\end{definition}
%TODO include Proposition 5.3.1.18. without proof
% \begin{prop} %HTT Proposition 5.3.3.3.
%     Let $C$ be an \inftycat/ and $\kappa$ a regular cardinal. Then the following are equivalent:
%     \begin{itemize}
%         \item $C$ is $\kappa$-filtered
%         \item The colimit functor $\colim\colon\Fun(C,\Spaces)\to\Spaces$ preserves $\kappa$-small limits.
%     \end{itemize}
% \end{prop}
\begin{definition} %HTT Definition 5.4.2.1.
    Let $\kappa$ be a regular cardinal and let $C$ be a small $\infty$-category.
    We define $\Ind_{\kappa}(C)\subset P(C)$ to be the full subcategory of $P(C)$ with objects consisting of those maps $C^{\op}\to\spaces$ that classify right fibrations $X\to C$ such that $X$ is $\kappa$-filtered. %TODO define what it means to classify
\end{definition}
\begin{definition}
    Let $\kappa$ be a regular cardinal. An \inftycat/ $C$ is \emph{$\kappa$-accessible} if there exists a small \inftycat/ $C^0$ and a categorical equivalence
    \begin{equation*}
        \Ind_{\kappa}(C^0)\to C\;.
    \end{equation*}
    We say that $C$ is \emph{accessible} if it is $\kappa$-accessible for some cardinal $\kappa$.
\end{definition}
%TODO why is it then accessible for bigger kappa? Proposition HTT 5.4.2.9.
\begin{definition}
    An \inftycat/ is \emph{locally presentable} if it is accessible and admits small colimits.
\end{definition}
\begin{lemma} %TODO HTT Corollary 5.5.2.4., maybe also Corollary 5.3.5.4.
    A locally presentable \inftycat/ $C$ admits small limits.
\end{lemma}
\begin{prop} %HTT Proposition A.3.7.6., due to Simpson
    Let $C$ be an \inftycat/. Then the following are equivalent:
    \begin{itemize}
        \item $C$ is locally presentable.
        \item There exists a combinatorical simplicial model category $M$ and a categorical equivalence $\Nhc(M^Â°)\simeq C$.
    \end{itemize}
\end{prop}
% \begin{definition}[Universality of Colimits] %TODO how to elegantly define pullback functor?
%     Let $C$ be an \inftycat/ that admits small colimits and pullbacks.
%     If for any map $u\colon x\to y\in C_1$ the pullback functor $u^*\colon \faktor{C}{y}\to\faktor{C}{x}$ preserves colimits, then we say that \emph{$C$ has universal colimits}.
% \end{definition}
\begin{definition}[Cartesian Transformation]
    Let $C$ be an \inftycat/ and let $K$ be a simplicial set.
    Let $q,p\in\Fun(K,C)_0$ and let $\alpha\in\Fun(K,C)_1$ be a natural transformation $\alpha\colon p\to q$.
    Then we say $\alpha$ is \emph{cartesian} if for all maps $u\colon\Delta^1\to K$ the induced map $\Delta^1\times\Delta^1\xrightarrow{\left(u,\id_{\Delta^1}\right)}K\times\Delta^1\xrightarrow{\alpha}C$ is a pullback square.
\end{definition}
% \begin{definition}[Descent] %HTT Definition 6.1.3.1.
%     Let $C$ be an \inftycat/ that admits small colimits and pullbacks.
    
%     Its objects the same as $\Fun(\Delta^1,C)$, but we set the morphisms between them to be maps $\Delta^1\times\Delta^1\to C$ that are pullback squares. %TODO this needs pasting law for pullbacks. Also, why can we just compute in \Fun(\Delta^1,C)?
    
%     We say that \emph{$C$ has descent} if $\Cart(C)$ has small colimits and the inclusion $\Cart(C)\subset\Fun(\Delta^1,C)$ preserves them.
% \end{definition}
%TODO HTT Proposition 4.4.2.6.
\begin{definition}[Universality]
    Let $C$ be an \inftycat/ that admits small colimits and pullbacks.
    We say that \emph{$C$ has universal colimits} if for all natural transformations $\alpha\colon p\to q\in\Fun(K^{\rhd},C)_1$ such that $q$ is a  colimit cone and $\alpha$ is cartesian, $p$ is a colimit cone.
\end{definition}
\begin{definition}[Descent]
    Let $C$ be an \inftycat/ that admits small colimits and pullbacks.
    We say that \emph{$C$ has descent} if for all natural transformations $\alpha\colon p\to q\in\Fun(K^{\rhd},C)_1$ such that $p,q$ are colimit cones and $\alpha|_K$ is cartesian, $\alpha$ is cartesian.
\end{definition}
\begin{lemma}
    A \inftycat/ $C$ has universal colimits if and only if it has universal pushouts and universal coproducts.
    \begin{proof}
        Let $\alpha\colon p\to q\in\Fun(K^{\rhd},C)_1$ be a cartesian transformation and let $q$ be a colimit cone. 
        We prove the statement first for all finite dimensional $K$ by induction over the dimension of $K$.

        For $\dim K=-1$ the statement is clear since $K$ is empty.
        
        Let $\dim K=n+1$. 
        Then by the skeletal filtration, $K=K^{n+1}=K^n\bigcup\limits_{\cup_S \partial\Delta^{n+1}}\cup_S \Delta^{n+1}$ where $S$ is the set of non-degenerate simplicies of dimension $n+1$.
        For ease of notation, we set $X_{0}=\cup_S \partial\Delta^{n+1}$, $X_1=K^n$ and $X_2=\cup_S \Delta^{n+1}$.

        Let $p_i,q_i\colon X_i^{\rhd}\to C$ be the maps obtained by precomposing $p$ or $q$ with the respective map to $K$ from the skeletal filtration and taking the conepoint of $q_i$ to be the colimit, and the conepoint of $p_i$ to be the pullback
        \begin{center}
            \begin{tikzpicture}
                \matrix (m) [matrix of math nodes,row sep=3em,column sep=4em,minimum width=2em]
                {
                  p_i(\infty) & q(\infty)\\
                  q_i(\infty) & p(\infty)\\};
                \path[-stealth]
    
                (m-1-1) edge (m-1-2)
                (m-1-1) edge (m-2-1)
                (m-2-1) edge (m-2-2)
                (m-1-2) edge (m-2-2);
            \end{tikzpicture}
        \end{center}
        Then $\alpha$ induces maps $\alpha_i\colon p_i\to q_i$ which are cartesian.

        By the induction hypothesis we thus have that $p_0$ and $p_1$ are colimit cones.

        Since $\Delta^{n+1}$ has a terminal object, colimits over $\Delta^{n+1}$ can be computed by evalutaing the terminal object.
        In particular it is given by evaluation of some element $x\in K_0$.

        Thus we have $q_2(\infty)\cong\bigcup\limits_{s\in S} q(x_s)$ (where we have the coproduct in $C$ here and the $x_s$ corresponding to the final vertices of the $\Delta^{n+1}$).
        So for every $s\in S$ the left square in the diagram
        \begin{center}
            \begin{tikzpicture}
                \matrix (m) [matrix of math nodes,row sep=3em,column sep=4em,minimum width=2em]
                {
                    p(x_s) & p_2(\infty) & p(\infty)\\
                    q(x_s) & q_2(\infty) & q(\infty)\\};
                \path[-stealth]
    
                (m-1-1) edge (m-1-2)
                (m-1-1) edge (m-2-1)
                (m-2-1) edge (m-2-2)
                (m-1-2) edge (m-2-2)
                (m-1-2) edge (m-1-3)
                (m-2-2) edge (m-2-3)
                (m-1-3) edge (m-2-3);
            \end{tikzpicture}
        \end{center}
        is pullback by the pasting law, thus by universality for coproducts $p_2(\infty)\cong\bigcup\limits_{s\in S} p(x_s)$ and in particular $p_2$ is a colimit cone.
        By %HTT Proposition 4.4.2.2.
        we know that 
        \begin{center}
            \begin{tikzpicture}
                \matrix (m) [matrix of math nodes,row sep=3em,column sep=4em,minimum width=2em]
                {
                  q_0(\infty) & q_1(\infty)\\
                  q_2(\infty) & q(\infty)\\};
                \path[-stealth]
    
                (m-1-1) edge (m-1-2)
                (m-1-1) edge (m-2-1)
                (m-2-1) edge (m-2-2)
                (m-1-2) edge (m-2-2);
            \end{tikzpicture}
        \end{center}
        is a pushout square, so the cube corresponding to a natural transformation $\beta\in\Fun\left(\left(\Lambda_0^2\right)^{\rhd},C\right)_1$
        \begin{center}
            \begin{tikzcd} [sep = .5 cm]
                p|_{X^{\rhd}}(\infty) \arrow [dr] \arrow [rr] \arrow [dd] & & p|_{\left(K^n\right)^{\rhd}}(\infty) \arrow [dr] \arrow [dd] \\
                & p|_{Y^{\rhd}}(\infty) \arrow [rr, crossing over] \arrow [dd] & & p(\infty) \arrow [dd] & \\
                q|_{X^{\rhd}}(\infty) \arrow [dr] \arrow [rr] & & q|_{\left(K^n\right)^{\rhd}}(\infty) \arrow [dr] \\
                & q|_{Y^{\rhd}}(\infty) \arrow [from=uu, crossing over] \arrow [rr] & & q(\infty) &
            \end{tikzcd}
        \end{center}
        is cartesian.
        By descent for pushouts (since the bottom square is pushout) we thus have that the top square is also a pushout.
        Again by %HTT Proposition 4.4.2.2.
        it thus follows that $p(\infty)$ is a colimit cone.

        It now remains to show that statement for general $K$.
        Let $L\subset\N(\Nat)$ (where we view $\Nat$ as a category $0\to1\to2\to3\ldots$) be the simplicial subset containing all $0$-simplices and only the $1$-simplices which are between consecutive integers (so all higher simplices are degenerate).
        It can be shown that the inclusion $L\subset\N(\Nat)$ is a categorical equivalence. %TODO maybe more detail, colimits can be computed as colimits over \N(\Nat) and skeletal filtration

        Let $\alpha\colon p\to q\in\Fun(K^{\rhd},C)_1$ be a cartesian transformation and let $q$ be a colimit cone and let $\left(K^n\right)_{n\in\Nat}$ denote the skeletal filtration of $K$.
        We can compute colimits over $K$ by computing the colimit of the diagram $\N(\Nat)\to C$ that for each $0$-simplex is the colimit of the skeleton of corresponding degree and all higher simplicies are given by chains of the canonical maps. 

        Since $L\subset\N(\Nat)$ is a categorical equivalence which preserve and reflect (co)limits, we can also compute the colimit of the induced diagram $L\to C$.

        So let $F_q\colon L^{\rhd}\to C$ be the diagram induced by taking colimits of the skeleta as above.
        Let $F_p\colon L^{\rhd}\to C$ be given on the $0$-simplices by taking pullbacks
        \begin{center}
            \begin{tikzpicture}
                \matrix (m) [matrix of math nodes,row sep=3em,column sep=4em,minimum width=2em]
                {
                  F_p(n) & F_q(n)\\
                  p(\infty)=F_p(\infty) & F_q(\infty)=q(\infty)\\};
                \path[-stealth]
    
                (m-1-1) edge (m-1-2)
                (m-1-1) edge (m-2-1)
                (m-2-1) edge (m-2-2)
                (m-1-2) edge (m-2-2);
            \end{tikzpicture}
        \end{center}
        and on $1$-simplices by taking canonical maps.
        Thus we get a cartesian natural transformation $\beta\colon F_p\to F_q$.
        By universality for finite dimensional $K$ we have that $F_p(n)$ is the colimit of $p$ restricted $K^n$.
        Since $L$ is $1$-dimensional, we have that $F_p$ is a colimit cone and thus $p(\infty)$ is the colimit of its skeleta.
        This proves that $p$ is a colimit cone and thus the proposition.
    \end{proof}
\end{lemma}
\begin{lemma}
    A \inftycat/ $C$ has descent if and only if it has descent for pushouts and coproducts. %TODO is this true? Or does one need universality?
    \begin{proof} %TODO maybe mention why it suffices to prove things for arrows x\to\infty TODO change notation p|_? to p_? and be more clear
        Let $\alpha\colon p\to q\in\Fun(K^{\rhd},C)_1$ be a map.
        We prove the statement first for all finite dimensional $K$ by induction over the dimension of $K$. %TODO define dimension

        For $\dim K=-1$ the statement is clear since $K$ is empty.

        %For $\dim K=0$ we have that $K\cong\bigcup\limits_{i\in I}\Delta^0$ for some small set $I$. 
        %In this case the statement is also clear since all maps are identity maps.

        So let $\dim K=n+1$.
        Then by the skeletal filtration, $K=K^{n+1}=K^n\bigcup\limits_{\cup_S \partial\Delta^{n+1}}\cup_S \Delta^{n+1}$ where $S$ is the set of non-degenerate simplicies of dimension $n+1$.
        For ease of notation, we set $X=\cup_S \partial\Delta^{n+1}$ and $Y=\cup_S \Delta^{n+1}$.

        By induction hypothesis and because $C$ admits small colimits, we obtain that $\alpha|_{\left(K^n\right)^{\rhd}}$, $\alpha|_{X^{\rhd}}$ are cartesian (where we abuse the notation of restriction, since it it not necessarily injective for $X$ and the conepoints which are the colimits are not necessarily in $K^{\rhd}$).

        The map $\alpha|_{Y^{\rhd}}$ is cartesian as well: Since $\Delta^{n+1}$ has a terminal object, the colimit can be computed by evaluating the final vertex. 
        In particular, the maps to the cone point are isomorphisms.
        Then one uses descent for coproducts.

        By %HTT Proposition 4.4.2.2.
        we know that the canonical diagrams in $C$
        \begin{center}
            \begin{tikzpicture}
                \matrix (m) [matrix of math nodes,row sep=3em,column sep=4em,minimum width=2em]
                {
                  p|_{X^{\rhd}}(\infty) & p|_{\left(K^n\right)^{\rhd}}(\infty)\\
                  p|_{Y^{\rhd}}(\infty) & p(\infty)\\};
                \path[-stealth]
    
                (m-1-1) edge (m-1-2)
                (m-1-1) edge (m-2-1)
                (m-2-1) edge (m-2-2)
                (m-1-2) edge (m-2-2);
            \end{tikzpicture}
            \begin{tikzpicture}
                \matrix (m) [matrix of math nodes,row sep=3em,column sep=4em,minimum width=2em]
                {
                  q|_{X^{\rhd}}(\infty) & q|_{\left(K^n\right)^{\rhd}}(\infty)\\
                  q|_{Y^{\rhd}}(\infty) & q(\infty)\\};
                \path[-stealth]
    
                (m-1-1) edge (m-1-2)
                (m-1-1) edge (m-2-1)
                (m-2-1) edge (m-2-2)
                (m-1-2) edge (m-2-2);
            \end{tikzpicture}
        \end{center}
        where $\infty$ denotes the respective cone points, are pushouts.
        Furthermore, we know that the diagrams 
        \begin{center}
            \begin{tikzpicture}
                \matrix (m) [matrix of math nodes,row sep=3em,column sep=4em,minimum width=2em]
                {
                  p|_{X^{\rhd}}(\infty) & p|_{\left(K^n\right)^{\rhd}}(\infty)\\
                  q|_{X^{\rhd}}(\infty) & q|_{\left(K^n\right)^{\rhd}}(\infty)\\};
                \path[-stealth]
    
                (m-1-1) edge (m-1-2)
                (m-1-1) edge (m-2-1)
                (m-2-1) edge (m-2-2)
                (m-1-2) edge (m-2-2);
            \end{tikzpicture}
            \begin{tikzpicture}
                \matrix (m) [matrix of math nodes,row sep=3em,column sep=4em,minimum width=2em]
                {
                  p|_{X^{\rhd}}(\infty) & p|_{Y^{\rhd}}(\infty)\\
                  q|_{X^{\rhd}}(\infty) & q|_{Y^{\rhd}}(\infty)\\};
                \path[-stealth]
    
                (m-1-1) edge (m-1-2)
                (m-1-1) edge (m-2-1)
                (m-2-1) edge (m-2-2)
                (m-1-2) edge (m-2-2);
            \end{tikzpicture}
        \end{center}
        are pullbacks: 

        For all $x\in X_0$ we have that the outer (by descent for $\alpha|_{\left(K^n\right)^{\rhd}}$) and right square of the diagram
        \begin{center}
            \begin{tikzpicture}
                \matrix (m) [matrix of math nodes,row sep=3em,column sep=1em,minimum width=2em]
                {
                    p|_{X^{\rhd}}(x) & q|_{X^{\rhd}}(\infty)\times_{q|_{\left(K^n\right)^{\rhd}}(\infty)}p|_{\left(K^n\right)^{\rhd}}(\infty) & p|_{\left(K^n\right)^{\rhd}}(\infty)\\
                    q|_{X^{\rhd}}(x) & q|_{X^{\rhd}}(\infty) & q|_{\left(K^n\right)^{\rhd}}(\infty)\\};
                \path[-stealth]
    
                (m-1-1) edge (m-1-2)
                (m-1-1) edge (m-2-1)
                (m-2-1) edge (m-2-2)
                (m-1-2) edge (m-2-2)
                (m-1-2) edge (m-1-3)
                (m-2-2) edge (m-2-3)
                (m-1-3) edge (m-2-3);
            \end{tikzpicture}
        \end{center}
        are pullback, so by the pasting law the left square is as well. 
        By universality, this implies that $q|_{X^{\rhd}}(\infty)\times_{q|_{\left(K^n\right)^{\rhd}}(\infty)}p|_{\left(K^n\right)^{\rhd}}(\infty)$ is a colimit of $p|_X$ and thus equivalent to $p|_{X^{\rhd}}(\infty)$.
        The other square follows analogously.

        Thus the natural transformation $\beta\colon\left(\Lambda_0^2\right)^{\rhd}\times\Delta^1\to C$ represented by the diagram
        \begin{center}
            \begin{tikzcd} [sep = .5 cm]
                p|_{X^{\rhd}}(\infty) \arrow [dr] \arrow [rr] \arrow [dd] & & p|_{\left(K^n\right)^{\rhd}}(\infty) \arrow [dr] \arrow [dd] \\
                & p|_{Y^{\rhd}}(\infty) \arrow [rr, crossing over] \arrow [dd] & & p(\infty) \arrow [dd] & \\
                q|_{X^{\rhd}}(\infty) \arrow [dr] \arrow [rr] & & q|_{\left(K^n\right)^{\rhd}}(\infty) \arrow [dr] \\
                & q|_{Y^{\rhd}}(\infty) \arrow [from=uu, crossing over] \arrow [rr] & & q(\infty) &
            \end{tikzcd}
        \end{center}
        is cartesian because $C$ has descent for pushouts.

        Since every object $x\in K$ already lies in the image of either $K^n$ or $Y$, the map $p(x)\to p(\infty)$ always factors as $p|_{K^n}(x)\to p|_{\left(K^n\right)^{\rhd}}(\infty)\to p(\infty)$ or $p|_{Y}(x)\to p|_{Y^{\rhd}}(\infty)\to p(\infty)$ where it follows by descent for $\alpha|_{\left(K^n\right)^{\rhd}}$ or $\alpha|_{Y^{\rhd}}$ respectively.

        The case for arbitrary $K$ follows from the following facts:

        Let $L\subset\N(\Nat)$ (where we view $\Nat$ as a category $0\to1\to2\to3\ldots$) be the simplicial subset containing all $0$-simplices and only the $1$-simplices which are between consecutive integers (so all higher simplices are degenerate).
        It can be shown that the inclusion $L\subset\N(\Nat)$ is a categorical equivalence. %TODO maybe more detail, colimits can be computed as colimits over \N(\Nat) and skeletal filtration

        So let $\alpha\colon p\to q$ be a natural transformation between colimit cones $p,q\colon K^{\rhd}\to C$ such that $\alpha|_K$ is cartesian.
        Let $K^n\subset K$ denote the $n$-th skeleton.
        Let $F_p\colon L^{\rhd}\to C$ be the functor that is the colimit of $K^n\xrightarrow{p|_{K^n}}C$ for each degree, $p(\infty)$ on the cone point and a choice of canonical map on the $1$-simplices.
        Let $F_q\colon L\to C$ denote the same construction for $q$.
        Then since $L\subset\N(\Nat)$ is a categorical equivalence, the colimit of $F_p|_L$ and $F_q|_L$ are $p(\infty)$ and $q(\infty)$ respectively, so $F_p$ and $F_q$ are already colimit cones.

        By descent for finite dimensions and universality we know that for all $n\in\Nat$ the squares
        \begin{center}
            \begin{tikzpicture}
                \matrix (m) [matrix of math nodes,row sep=3em,column sep=4em,minimum width=2em]
                {
                  p|_{K^n}(\infty) & p|_{K^{n+1}}(\infty)\\
                  q|_{K^n}(\infty) & q|_{K^{n+1}}(\infty)\\};
                \path[-stealth]
    
                (m-1-1) edge (m-1-2)
                (m-1-1) edge (m-2-1)
                (m-2-1) edge (m-2-2)
                (m-1-2) edge (m-2-2);
            \end{tikzpicture}
        \end{center}
        are pullback, so the induced transformation $\beta\colon F_p\to F_q$ is cartesian when restricted to $L$.
        Since $L$ is $1$-dimensional, again from descent we have that $\beta$ is cartesian.
        This shows that for all $n\in\Nat$ the square
        \begin{center}
            \begin{tikzpicture}
                \matrix (m) [matrix of math nodes,row sep=3em,column sep=4em,minimum width=2em]
                {
                  p|_{K^n}(\infty) & p(\infty)\\
                  q|_{K^n}(\infty) & q(\infty)\\};
                \path[-stealth]
    
                (m-1-1) edge (m-1-2)
                (m-1-1) edge (m-2-1)
                (m-2-1) edge (m-2-2)
                (m-1-2) edge (m-2-2);
            \end{tikzpicture}
        \end{center}
        is cartesian.

        We want to show that 
        \begin{center}
            \begin{tikzpicture}
                \matrix (m) [matrix of math nodes,row sep=3em,column sep=4em,minimum width=2em]
                {
                  p(x) & p(\infty)\\
                  q(x) & q(\infty)\\};
                \path[-stealth]
    
                (m-1-1) edge (m-1-2)
                (m-1-1) edge (m-2-1)
                (m-2-1) edge (m-2-2)
                (m-1-2) edge (m-2-2);
            \end{tikzpicture}
        \end{center}
        is a pullback for a all $x\in K_0$. 
        But every such $x$ already is in some $K^n$, so we obtain a factorization
        \begin{center}
            \begin{tikzpicture}
                \matrix (m) [matrix of math nodes,row sep=3em,column sep=4em,minimum width=2em]
                {
                    p(x)=p|_{K^n}(x) & p|_{K^n}(\infty) & p(\infty)\\
                    q(x)=q|_{K^n}(x) & q|_{K^n}(\infty) & q(\infty)\\};
                \path[-stealth]
    
                (m-1-1) edge (m-1-2)
                (m-1-1) edge (m-2-1)
                (m-2-1) edge (m-2-2)
                (m-1-2) edge (m-2-2)
                (m-1-2) edge (m-1-3)
                (m-2-2) edge (m-2-3)
                (m-1-3) edge (m-2-3);
            \end{tikzpicture}
        \end{center}
        where the left square is pullback by descent for finite dimensions. 
        Thus the outer square cartesian, proving the propsition.
    \end{proof}
\end{lemma}
\begin{definition}[\infty-Topos]
    Let $C$ be an \inftycat/ fulfilling the following properties:
    \begin{itemize}
        \item $C$ is locally presentable.
        \item $C$ has universal colimits.
        \item $C$ has descent.
    \end{itemize}
    Then we call $C$ an \emph{\infty-topos}.
\end{definition}